<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé˜…è¯»åˆ†ææŠ¥å‘Š - PO18å°è¯´ä¸‹è½½ç«™</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/components.css">
    <style>
        .analysis-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }

        .analysis-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: var(--md-elevation-3);
        }

        .analysis-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
        }

        .analysis-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .analysis-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--md-surface-container);
            padding: 8px 16px;
            border-radius: 12px;
        }

        .control-group label {
            font-size: 13px;
            color: var(--md-on-surface-variant);
            font-weight: 500;
        }

        .control-group select {
            padding: 6px 12px;
            border: 1px solid var(--md-outline-variant);
            border-radius: 8px;
            background: var(--md-surface);
            color: var(--md-on-surface);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-group select:hover {
            border-color: var(--md-primary);
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .analyze-button {
            padding: 10px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--md-elevation-2);
        }

        .analyze-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--md-elevation-3);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--md-surface-container);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--md-outline-variant);
            border-top-color: var(--md-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--md-on-surface-variant);
            font-size: 14px;
        }

        .analysis-content {
            background: var(--md-surface-container);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--md-elevation-2);
            margin-bottom: 24px;
        }

        .analysis-markdown {
            color: var(--md-on-surface);
            line-height: 1.8;
            font-size: 15px;
        }

        .analysis-markdown h1,
        .analysis-markdown h2,
        .analysis-markdown h3 {
            color: var(--md-primary);
            margin-top: 32px;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .analysis-markdown h1 {
            font-size: 24px;
            border-bottom: 2px solid var(--md-primary-container);
            padding-bottom: 8px;
        }

        .analysis-markdown h2 {
            font-size: 20px;
        }

        .analysis-markdown h3 {
            font-size: 18px;
        }

        .analysis-markdown p {
            margin: 12px 0;
        }

        .analysis-markdown ul,
        .analysis-markdown ol {
            margin: 12px 0;
            padding-left: 24px;
        }

        .analysis-markdown li {
            margin: 8px 0;
        }

        .analysis-markdown strong {
            color: var(--md-primary);
            font-weight: 600;
        }

        .analysis-markdown code {
            background: var(--md-surface-container-high);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .analysis-markdown blockquote {
            border-left: 4px solid var(--md-primary);
            padding-left: 16px;
            margin: 16px 0;
            color: var(--md-on-surface-variant);
            font-style: italic;
        }

        .error-state {
            background: var(--md-error-container);
            color: var(--md-on-error-container);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            text-align: center;
        }

        .data-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .data-card {
            background: var(--md-surface-container-high);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .data-card-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--md-primary);
            margin-bottom: 8px;
        }

        .data-card-label {
            font-size: 13px;
            color: var(--md-on-surface-variant);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--md-surface-container);
            color: var(--md-on-surface);
            text-decoration: none;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.2s;
            margin-bottom: 20px;
        }

        .back-button:hover {
            background: var(--md-surface-container-high);
            transform: translateX(-4px);
        }

        @media (max-width: 768px) {
            .analysis-container {
                padding: 12px;
            }

            .analysis-header {
                padding: 20px;
            }

            .analysis-header h1 {
                font-size: 22px;
            }

            .analysis-content {
                padding: 20px;
            }

            .analysis-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                justify-content: space-between;
            }

            .data-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="analysis-container">
        <a href="/" class="back-button">â† è¿”å›é¦–é¡µ</a>

        <div class="analysis-header">
            <h1>ğŸ¤– AIé˜…è¯»åˆ†ææŠ¥å‘Š</h1>
            <p>åŸºäºæ‚¨çš„é˜…è¯»æ•°æ®ï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–çš„é˜…è¯»åˆ†ææŠ¥å‘Š</p>
        </div>

        <div class="analysis-controls">
            <div class="control-group">
                <label>åˆ†æå‘¨æœŸï¼š</label>
                <select id="period-select">
                    <option value="all">å…¨éƒ¨æ•°æ®</option>
                    <option value="year">è¿‘ä¸€å¹´</option>
                    <option value="month">è¿‘ä¸€æœˆ</option>
                </select>
            </div>
            <div class="control-group">
                <label>AIæ¨¡å‹ï¼š</label>
                <select id="model-select">
                    <option value="grok-4-0709">grok-4-0709ï¼ˆé«˜è´¨é‡ï¼‰</option>
                    <option value="grok-4-1-fast-non-reasoning">grok-4-1-fast-non-reasoning</option>
                    <option value="grok-4-1-fast-reasoning">grok-4-1-fast-reasoning</option>
                    <option value="grok-4-fast-reasoning">grok-4-fast-reasoning</option>
                </select>
            </div>
            <button class="analyze-button" id="analyze-btn">
                <span>âœ¨</span>
                <span>ç”Ÿæˆåˆ†ææŠ¥å‘Š</span>
            </button>
            <button class="analyze-button" id="config-btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <span>âš™ï¸</span>
                <span>AIé…ç½®</span>
            </button>
        </div>

        <div id="data-summary" class="data-summary" style="display: none;">
            <!-- æ•°æ®æ‘˜è¦å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div id="loading-state" class="loading-state" style="display: none;">
            <div class="loading-spinner"></div>
            <div class="loading-text">AIæ­£åœ¨åˆ†ææ‚¨çš„é˜…è¯»æ•°æ®ï¼Œè¯·ç¨å€™...</div>
        </div>

        <div id="error-state" class="error-state" style="display: none;">
            <!-- é”™è¯¯ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>

        <div id="analysis-content" class="analysis-content" style="display: none;">
            <div class="analysis-markdown" id="analysis-markdown"></div>
        </div>
    </div>

    <!-- AIé…ç½®å¯¹è¯æ¡† -->
    <div id="config-modal" class="config-modal" style="display: none;">
        <div class="config-modal-content">
            <div class="config-modal-header">
                <h2>ğŸ¤– AIé…ç½®</h2>
                <button class="config-modal-close" id="config-modal-close">Ã—</button>
            </div>
            <div class="config-modal-body">
                <div class="config-form-group">
                    <label for="config-api-url">APIåœ°å€ï¼š</label>
                    <input type="text" id="config-api-url" placeholder="https://api.pipellm.ai/v1/chat/completions" />
                    <small>AI APIçš„å®Œæ•´åœ°å€</small>
                </div>
                <div class="config-form-group">
                    <label for="config-api-key">APIå¯†é’¥ï¼š</label>
                    <input type="password" id="config-api-key" placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥" />
                    <small>æ‚¨çš„APIå¯†é’¥å°†å®‰å…¨ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Š</small>
                </div>
                <div class="config-form-group">
                    <label>å½“å‰çŠ¶æ€ï¼š</label>
                    <div id="config-status" style="padding: 8px; background: var(--md-surface-container-high); border-radius: 8px; font-size: 13px;">
                        åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="config-modal-footer">
                <button class="config-button config-button-secondary" id="config-cancel-btn">å–æ¶ˆ</button>
                <button class="config-button config-button-primary" id="config-save-btn">ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>

    <style>
        .config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .config-modal-content {
            background: var(--md-surface);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--md-elevation-5);
        }

        .config-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--md-outline-variant);
        }

        .config-modal-header h2 {
            margin: 0;
            font-size: 20px;
            color: var(--md-on-surface);
        }

        .config-modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--md-on-surface-variant);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .config-modal-close:hover {
            background: var(--md-surface-container-high);
            color: var(--md-on-surface);
        }

        .config-modal-body {
            padding: 24px;
        }

        .config-form-group {
            margin-bottom: 20px;
        }

        .config-form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--md-on-surface);
        }

        .config-form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--md-outline-variant);
            border-radius: 8px;
            font-size: 14px;
            background: var(--md-surface);
            color: var(--md-on-surface);
            box-sizing: border-box;
            transition: all 0.2s;
        }

        .config-form-group input:focus {
            outline: none;
            border-color: var(--md-primary);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .config-form-group small {
            display: block;
            margin-top: 4px;
            font-size: 12px;
            color: var(--md-on-surface-variant);
        }

        .config-modal-footer {
            display: flex;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--md-outline-variant);
            justify-content: flex-end;
        }

        .config-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .config-button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .config-button-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--md-elevation-2);
        }

        .config-button-secondary {
            background: var(--md-surface-container);
            color: var(--md-on-surface);
        }

        .config-button-secondary:hover {
            background: var(--md-surface-container-high);
        }
    </style>

    <script src="/js/api.js"></script>
    <script>
        // æ”¹è¿›çš„Markdownè½¬HTMLè½¬æ¢å™¨
        function markdownToHtml(markdown) {
            if (!markdown) return '';
            
            let html = markdown;
            
            // ä»£ç å—ï¼ˆå…ˆå¤„ç†ï¼Œé¿å…è¢«å…¶ä»–è§„åˆ™å½±å“ï¼‰
            html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            
            // è¡Œå†…ä»£ç 
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // ç²—ä½“
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');
            
            // æ–œä½“
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            html = html.replace(/_(.*?)_/g, '<em>$1</em>');
            
            // åˆ†å‰²æˆè¡Œå¤„ç†
            const lines = html.split('\n');
            const result = [];
            let inList = false;
            let listItems = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // æ ‡é¢˜
                if (line.startsWith('### ')) {
                    if (inList) {
                        result.push('<ul>' + listItems.join('') + '</ul>');
                        listItems = [];
                        inList = false;
                    }
                    result.push('<h3>' + line.substring(4) + '</h3>');
                    continue;
                }
                if (line.startsWith('## ')) {
                    if (inList) {
                        result.push('<ul>' + listItems.join('') + '</ul>');
                        listItems = [];
                        inList = false;
                    }
                    result.push('<h2>' + line.substring(3) + '</h2>');
                    continue;
                }
                if (line.startsWith('# ')) {
                    if (inList) {
                        result.push('<ul>' + listItems.join('') + '</ul>');
                        listItems = [];
                        inList = false;
                    }
                    result.push('<h1>' + line.substring(2) + '</h1>');
                    continue;
                }
                
                // åˆ—è¡¨é¡¹
                if (line.match(/^[\-\*\+]\s/)) {
                    if (!inList) {
                        inList = true;
                    }
                    listItems.push('<li>' + line.substring(2) + '</li>');
                    continue;
                }
                if (line.match(/^\d+\.\s/)) {
                    if (!inList) {
                        inList = true;
                    }
                    listItems.push('<li>' + line.replace(/^\d+\.\s/, '') + '</li>');
                    continue;
                }
                
                // ç»“æŸåˆ—è¡¨
                if (inList && line === '') {
                    result.push('<ul>' + listItems.join('') + '</ul>');
                    listItems = [];
                    inList = false;
                    continue;
                }
                
                // æ®µè½
                if (line === '') {
                    if (inList) {
                        result.push('<ul>' + listItems.join('') + '</ul>');
                        listItems = [];
                        inList = false;
                    }
                    continue;
                }
                
                if (inList) {
                    // ç»§ç»­åˆ—è¡¨é¡¹
                    if (listItems.length > 0) {
                        listItems[listItems.length - 1] = listItems[listItems.length - 1].replace('</li>', ' ' + line + '</li>');
                    }
                } else {
                    // æ™®é€šæ®µè½
                    if (line.startsWith('>')) {
                        result.push('<blockquote>' + line.substring(1).trim() + '</blockquote>');
                    } else {
                        result.push('<p>' + line + '</p>');
                    }
                }
            }
            
            // å¤„ç†å‰©ä½™çš„åˆ—è¡¨
            if (inList && listItems.length > 0) {
                result.push('<ul>' + listItems.join('') + '</ul>');
            }
            
            return result.join('\n');
        }

        // æ˜¾ç¤ºæ•°æ®æ‘˜è¦
        function showDataSummary(data) {
            const container = document.getElementById('data-summary');
            if (!data || !data.summary) {
                container.style.display = 'none';
                return;
            }

            const summary = data.summary;
            container.innerHTML = `
                <div class="data-card">
                    <div class="data-card-value">${summary.totalDays}</div>
                    <div class="data-card-label">æ€»é˜…è¯»å¤©æ•°</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value">${summary.totalHours}</div>
                    <div class="data-card-label">æ€»é˜…è¯»æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value">${summary.avgMinutesPerDay}</div>
                    <div class="data-card-label">æ—¥å‡é˜…è¯»ï¼ˆåˆ†é’Ÿï¼‰</div>
                </div>
                <div class="data-card">
                    <div class="data-card-value">${data.streak.current}</div>
                    <div class="data-card-label">å½“å‰è¿ç»­å¤©æ•°</div>
                </div>
            `;
            container.style.display = 'grid';
        }

        // ç”Ÿæˆåˆ†ææŠ¥å‘Š
        async function generateAnalysis() {
            const period = document.getElementById('period-select').value;
            const model = document.getElementById('model-select').value;
            const analyzeBtn = document.getElementById('analyze-btn');
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');
            const analysisContent = document.getElementById('analysis-content');
            const dataSummary = document.getElementById('data-summary');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            analyzeBtn.disabled = true;
            loadingState.style.display = 'block';
            errorState.style.display = 'none';
            analysisContent.style.display = 'none';
            dataSummary.style.display = 'none';

            try {
                const response = await API.userStats.getReadingAnalysis(model, period);
                
                if (response.success) {
                    // æ˜¾ç¤ºæ•°æ®æ‘˜è¦
                    showDataSummary(response.data);
                    
                    // æ˜¾ç¤ºåˆ†æå†…å®¹
                    const markdownContent = response.analysis;
                    const htmlContent = markdownToHtml(markdownContent);
                    document.getElementById('analysis-markdown').innerHTML = htmlContent;
                    analysisContent.style.display = 'block';
                } else {
                    throw new Error(response.error || 'åˆ†æå¤±è´¥');
                }
            } catch (error) {
                console.error('AIåˆ†æå¤±è´¥:', error);
                let errorMessage = error.message || 'æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                
                // å¦‚æœæ˜¯400é”™è¯¯ï¼Œå¯èƒ½æ˜¯é…ç½®é—®é¢˜
                if (error.status === 400) {
                    errorMessage = error.message || 'è¯·æ£€æŸ¥AIé…ç½®æ˜¯å¦æ­£ç¡®';
                }
                
                errorState.innerHTML = `
                    <strong>åˆ†æå¤±è´¥</strong><br>
                    ${errorMessage}<br>
                    <small style="margin-top: 8px; display: block; color: var(--md-on-surface-variant);">
                        æç¤ºï¼šå¦‚æœè¿™æ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·å…ˆç‚¹å‡»"AIé…ç½®"æŒ‰é’®é…ç½®APIå¯†é’¥
                    </small>
                `;
                errorState.style.display = 'block';
            } finally {
                loadingState.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        }

        // é…ç½®å¯¹è¯æ¡†ç›¸å…³
        const configModal = document.getElementById('config-modal');
        const configBtn = document.getElementById('config-btn');
        const configCloseBtn = document.getElementById('config-modal-close');
        const configCancelBtn = document.getElementById('config-cancel-btn');
        const configSaveBtn = document.getElementById('config-save-btn');
        const configApiUrlInput = document.getElementById('config-api-url');
        const configApiKeyInput = document.getElementById('config-api-key');
        const configStatus = document.getElementById('config-status');

        // æ‰“å¼€é…ç½®å¯¹è¯æ¡†
        function openConfigModal() {
            loadAIConfig();
            configModal.style.display = 'flex';
        }

        // å…³é—­é…ç½®å¯¹è¯æ¡†
        function closeConfigModal() {
            configModal.style.display = 'none';
            // æ¸…ç©ºè¾“å…¥æ¡†ï¼ˆä¸ä¿å­˜ï¼‰
            configApiKeyInput.value = '';
        }

        // åŠ è½½AIé…ç½®
        async function loadAIConfig() {
            try {
                const config = await API.userStats.getAIConfig();
                configApiUrlInput.value = config.apiUrl || '';
                configApiKeyInput.value = ''; // ä¸æ˜¾ç¤ºå¯†é’¥
                
                if (config.hasApiKey) {
                    if (config.isDefault) {
                        configStatus.innerHTML = '<span style="color: var(--md-success);">âœ“ ä½¿ç”¨é»˜è®¤APIé…ç½®ï¼ˆå¯ä¿®æ”¹ï¼‰</span>';
                    } else {
                        configStatus.innerHTML = '<span style="color: var(--md-success);">âœ“ å·²é…ç½®è‡ªå®šä¹‰API</span>';
                    }
                } else {
                    configStatus.innerHTML = '<span style="color: var(--md-warning);">âš  æœªé…ç½®APIå¯†é’¥ï¼Œè¯·å¡«å†™APIåœ°å€å’Œå¯†é’¥</span>';
                }
            } catch (error) {
                console.error('åŠ è½½AIé…ç½®å¤±è´¥:', error);
                configStatus.innerHTML = '<span style="color: var(--md-error);">âœ— åŠ è½½é…ç½®å¤±è´¥</span>';
            }
        }

        // ä¿å­˜AIé…ç½®
        async function saveAIConfig() {
            const apiUrl = configApiUrlInput.value.trim();
            const apiKey = configApiKeyInput.value.trim();

            if (!apiUrl || !apiKey) {
                alert('è¯·å¡«å†™APIåœ°å€å’Œå¯†é’¥');
                return;
            }

            try {
                configSaveBtn.disabled = true;
                configSaveBtn.textContent = 'ä¿å­˜ä¸­...';
                
                await API.userStats.saveAIConfig(apiUrl, apiKey);
                
                configStatus.innerHTML = '<span style="color: var(--md-success);">âœ“ é…ç½®å·²ä¿å­˜</span>';
                
                setTimeout(() => {
                    closeConfigModal();
                    configSaveBtn.disabled = false;
                    configSaveBtn.textContent = 'ä¿å­˜é…ç½®';
                }, 1000);
            } catch (error) {
                console.error('ä¿å­˜AIé…ç½®å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥: ' + (error.details || error.message || 'æœªçŸ¥é”™è¯¯'));
                configSaveBtn.disabled = false;
                configSaveBtn.textContent = 'ä¿å­˜é…ç½®';
            }
        }

        // ç»‘å®šäº‹ä»¶
        document.getElementById('analyze-btn').addEventListener('click', generateAnalysis);
        configBtn.addEventListener('click', openConfigModal);
        configCloseBtn.addEventListener('click', closeConfigModal);
        configCancelBtn.addEventListener('click', closeConfigModal);
        configSaveBtn.addEventListener('click', saveAIConfig);

        // ç‚¹å‡»èƒŒæ™¯å…³é—­å¯¹è¯æ¡†
        configModal.addEventListener('click', (e) => {
            if (e.target === configModal) {
                closeConfigModal();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åŠ è½½é…ç½®çŠ¶æ€
        window.addEventListener('DOMContentLoaded', () => {
            loadAIConfig();
        });
    </script>
</body>
</html>

