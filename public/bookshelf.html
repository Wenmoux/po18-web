<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <title>è¼è˜¼è¾ - å½“æ—¶æ˜æœˆ</title>

        <!-- æ€§èƒ½ä¼˜åŒ–ï¼šé¢„åŠ è½½CSS -->
        <link rel="preload" href="css/style.css?v=20251224e" as="style" />
        <link rel="preload" href="css/components.css?v=20251224e" as="style" />

        <!-- DNSé¢„è§£æ -->
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
        <link rel="dns-prefetch" href="https://www.po18.tw" />
        <link rel="dns-prefetch" href="https://www.popo.tw" />
        <link rel="dns-prefetch" href="https://unpkg.com" />
        <link rel="preconnect" href="https://unpkg.com" crossorigin />

        <!-- PWAæ”¯æŒ -->
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" content="#D81B60" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="è¼è˜¼è¾">
        <link rel="apple-touch-icon" href="/icons/icon.svg" />

        <!-- å…³é”®CSSSå†…è” -->
        <style>
            /* é¦–å±å…³é”®CCS */
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: #fafafa;
                color: #333;
                line-height: 1.6;
            }
            .loading { opacity: 0; }
            .loaded { opacity: 1; transition: opacity 0.3s ease; }
            .skeleton { 
                background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                background-size: 200% 100%;
                animation: skeleton-loading 1.5s ease-in-out infinite;
                border-radius: 8px;
            }
            @keyframes skeleton-loading {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }
            .skeleton-card { height: 120px; margin-bottom: 16px; }
            #app { min-height: 100vh; }
            /* å¼ºåˆ¶éšè—æ—§ä¹¦æ¶å®¹å™¨ */
            #bookshelf-list {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
                opacity: 0 !important;
                pointer-events: none !important;
                height: 0 !important;
                overflow: hidden !important;
            }
            /* ç¡®ä¿æ™ºèƒ½ä¹¦æ¶å®¹å™¨æ˜¾ç¤º */
            #bookshelf-container {
                display: block !important;
            }
        </style>

        <link rel="stylesheet" href="css/style.css?v=20251224e" />
        <link rel="stylesheet" href="css/bookshelf.css?v=20251224e" />
        <link rel="stylesheet" href="css/components.css?v=20251224e" />
        <link rel="stylesheet" href="css/mobile-enhancements.css?v=20251224e" />

        <!-- å­—ä½“å¼‚æ­¥åŠ è½½ -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600&display=swap"
            rel="stylesheet"
            media="print"
            onload="this.media = 'all'"
        />
        <noscript>
            <link
                href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600&display=swap"
                rel="stylesheet"
            />
        </noscript>
    </head>
    <body>
        <div id="app">
            <!-- é¡¶éƒ¨å¯¼èˆª - MD3é£æ ¼ -->
            <header class="header">
                <div class="logo">
                    <span class="logo-icon">ğŸŒ¸</span>
                    <span class="logo-text">è¼è˜¼è¾</span>
                </div>
                <nav class="nav" id="main-nav">
                    <a href="index.html" class="nav-link" data-page="download">ğŸ  é¦–é¡µ</a>
                    <a href="rankings.html" class="nav-link" data-page="rankings">ğŸ† èŠ±äº‹äº†</a>
                    <a href="bookshelf.html" class="nav-link active" data-page="bookshelf">ğŸ“– å½“æ—¶æ˜æœˆ</a>
                    <a href="index.html#downloads" class="nav-link" data-page="downloads">ğŸ“¥ åº­é™¢æ·±æ·±</a>
                    <a href="index.html#library" class="nav-link" data-page="library">ğŸ“š èŠ±äº‹äº†</a>
                    <a href="index.html#subscriptions" class="nav-link" data-page="subscriptions" id="nav-subscriptions">
                        ğŸ”” è¥¿çª—è¯
                        <span class="nav-badge" id="subscription-badge" style="display: none">0</span>
                    </a>
                    <a href="index.html#settings" class="nav-link" data-page="settings">ğŸ‘¤ æˆ‘çš„</a>
                </nav>
                <div class="user-area" id="user-area">
                    <button class="btn btn-primary" id="btn-login">ç™»å½•</button>
                    <button class="btn btn-outline" id="btn-register">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="user-info" style="display: none">
                    <a href="/admin.html" id="admin-link" class="btn btn-sm btn-tonal" style="display: none">ğŸ“Š ç®¡ç†</a>
                    <button class="theme-toggle" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
                    <button class="btn btn-sm btn-outline" id="btn-logout">ç™»å‡º</button>
                </div>
            </header>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="main-content">
                <!-- æˆ‘çš„ä¹¦æ¶é¡µ -->
                <section class="page active" id="page-bookshelf">
                    <div>
                        <h2>ğŸ“– å½“æ—¶æ˜æœˆ</h2>
                        <p class="page-subtitle">è®°å½•ä½ çš„é˜…è¯»å†ç¨‹</p>
                    </div>

                    <!-- ç­›é€‰å’Œæ’åº - å·²éšè—ï¼Œä½¿ç”¨æ™ºèƒ½ä¹¦æ¶çš„æ ‡ç­¾ç­›é€‰å™¨ -->
                    <div class="filter-bar" style="display: none !important; visibility: hidden !important;">
                        <select id="bookshelf-sort-select" class="md-select">
                            <option value="recent">æœ€è¿‘é˜…è¯»</option>
                            <option value="progress">é˜…è¯»è¿›åº¦</option>
                            <option value="time">é˜…è¯»æ—¶é•¿</option>
                            <option value="added">æ·»åŠ æ—¶é—´</option>
                        </select>
                    </div>

                    <!-- æ™ºèƒ½ä¹¦æ¶å®¹å™¨ -->
                    <div id="bookshelf-container">
                        <!-- æ ‡ç­¾ç­›é€‰å™¨ -->
                        <div class="tag-filters" id="tag-filters-container"></div>

                        <!-- æ‰¹é‡æ“ä½œæ  -->
                        <div class="bookshelf-batch-actions" id="bookshelf-batch-actions" style="display: none;">
                            <div class="batch-info">
                                <span>å·²é€‰æ‹© <span id="batch-count">0</span> æœ¬ä¹¦</span>
                            </div>
                            <div class="batch-controls">
                                <select id="batch-tag-select" class="md-select">
                                    <option value="">é€‰æ‹©æ ‡ç­¾</option>
                                </select>
                                <button class="btn btn-sm btn-primary" id="batch-apply-tag">åº”ç”¨æ ‡ç­¾</button>
                                <button class="btn btn-sm btn-outline" id="batch-mark-read">æ ‡è®°å·²è¯»</button>
                                <button class="btn btn-sm btn-outline" id="batch-mark-unread">æ ‡è®°æœªè¯»</button>
                                <button class="btn btn-sm btn-outline" id="batch-cancel">å–æ¶ˆ</button>
                            </div>
                        </div>

                        <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
                        <div class="bookshelf-toolbar">
                            <button class="btn btn-outline btn-sm" id="bookshelf-batch-mode">æ‰¹é‡æ“ä½œ</button>
                        </div>

                        <!-- ä¹¦æ¶åˆ—è¡¨ï¼ˆæ™ºèƒ½åˆ†ç»„ï¼‰ -->
                        <div class="bookshelf-groups">
                            <div id="bookshelf-group-reading" class="bookshelf-group" style="display: none;">
                                <h3 class="group-title">ğŸ“– é˜…è¯»ä¸­</h3>
                                <div class="bookshelf-list" id="bookshelf-list-reading"></div>
                            </div>
                            <div id="bookshelf-group-to-read" class="bookshelf-group" style="display: none;">
                                <h3 class="group-title">ğŸ“š å¾…è¯»</h3>
                                <div class="bookshelf-list" id="bookshelf-list-to-read"></div>
                            </div>
                            <div id="bookshelf-group-finished" class="bookshelf-group" style="display: none;">
                                <h3 class="group-title">âœ… å·²è¯»å®Œ</h3>
                                <div class="bookshelf-list" id="bookshelf-list-finished"></div>
                            </div>
                            <div id="bookshelf-group-dropped" class="bookshelf-group" style="display: none;">
                                <h3 class="group-title">ğŸ—‘ï¸ å·²å¼ƒ</h3>
                                <div class="bookshelf-list" id="bookshelf-list-dropped"></div>
                            </div>
                            <div id="bookshelf-group-default" class="bookshelf-group" style="display: none;">
                                <h3 class="group-title">ğŸ“¦ æœªåˆ†ç±»</h3>
                                <div class="bookshelf-list" id="bookshelf-list-default"></div>
                            </div>
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div id="bookshelf-empty" class="empty-message" style="display: none;">
                            <p>ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»æ·»åŠ ä½ å–œæ¬¢çš„ä¹¦ç±å§</p>
                        </div>

                        <!-- å…¼å®¹æ—§ç‰ˆï¼šä¿ç•™åŸæœ‰åˆ—è¡¨å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                        <div class="bookshelf-list" id="bookshelf-list" style="display: none !important; visibility: hidden !important; position: absolute !important; left: -9999px !important; opacity: 0 !important;">
                            <p class="empty-message">ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»æ·»åŠ ä½ å–œæ¬¢çš„ä¹¦ç±å§</p>
                        </div>
                    </div>
                </section>
            </main>

            <!-- åº•éƒ¨ -->
            <footer class="footer">
                <p>è¼è˜¼è¾ &copy; 2024 | ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨</p>
            </footer>
        </div>

        <!-- ç™»å½•/æ³¨å†Œå¼¹çª— -->
        <div class="modal-overlay" id="auth-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 id="auth-modal-title">ç™»å½•</h3>
                    <button class="modal-close" id="auth-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="auth-form">
                        <div class="form-group">
                            <label for="auth-username">ç”¨æˆ·å</label>
                            <input type="text" id="auth-username" required minlength="3" />
                        </div>
                        <div class="form-group">
                            <label for="auth-password">å¯†ç </label>
                            <input type="password" id="auth-password" required minlength="6" />
                        </div>
                        <div class="form-error" id="auth-error"></div>
                        <button type="submit" class="btn btn-primary btn-block" id="auth-submit">ç™»å½•</button>
                    </form>
                    <div class="auth-switch">
                        <span id="auth-switch-text">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
                        <a href="#" id="auth-switch-link">å»æ³¨å†Œ</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toastæ¶ˆæ¯ -->
        <div class="toast-container" id="toast-container"></div>

        <!-- ç§»åŠ¨ç«¯åº•éƒ¨Tabå¯¼èˆª -->
        <nav class="bottom-tab-bar" id="bottom-tab-bar">
            <a href="index.html" class="tab-item" data-page="download">
                <span class="tab-icon">ğŸ“¥</span>
                <span class="tab-label">å¿«é€Ÿä¸‹è½½</span>
            </a>
            <a href="bookshelf.html" class="tab-item active" data-page="bookshelf">
                <span class="tab-icon">ğŸ“š</span>
                <span class="tab-label">å½“æ—¶æ˜æœˆ</span>
            </a>
            <a href="rankings.html" class="tab-item" data-page="rankings">
                <span class="tab-icon">ğŸ†</span>
                <span class="tab-label">èŠ±äº‹äº†</span>
            </a>
            <a href="index.html#subscriptions" class="tab-item" data-page="subscriptions" id="tab-subscriptions">
                <span class="tab-icon">ğŸ””</span>
                <span class="tab-label">è¥¿çª—è¯</span>
                <span class="tab-badge" id="tab-subscription-badge">0</span>
            </a>
            <a href="index.html#settings" class="tab-item" data-page="settings">
                <span class="tab-icon">ğŸ‘¤</span>
                <span class="tab-label">æˆ‘çš„</span>
            </a>
        </nav>

        <script src="js/performance-optimizer.js?v=20251224e"></script>
        <script src="js/utils.js?v=20251224e"></script>
        <script src="js/mobile-enhancements.js?v=20251224e"></script>
        <script src="js/api.js?v=20251224e"></script>
        <script src="js/app.js?v=20251224e"></script>
        <script src="js/smart-bookshelf.js?v=20251224e"></script>
        
        <!-- ç¡®ä¿æ™ºèƒ½ä¹¦æ¶æ­£ç¡®åˆå§‹åŒ– -->
        <script>
            // ç«‹å³å¼ºåˆ¶éšè—æ—§å®¹å™¨
            (function() {
                function hideOldContainer() {
                    const oldContainer = document.getElementById('bookshelf-list');
                    if (oldContainer) {
                        oldContainer.style.display = 'none';
                        oldContainer.style.visibility = 'hidden';
                        oldContainer.style.position = 'absolute';
                        oldContainer.style.left = '-9999px';
                    }
                }
                
                // ç«‹å³æ‰§è¡Œ
                hideOldContainer();
                
                // DOMåŠ è½½åå†æ¬¡æ‰§è¡Œ
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', hideOldContainer);
                }
                
                // é¡µé¢å®Œå…¨åŠ è½½åå†æ¬¡æ‰§è¡Œ
                window.addEventListener('load', function() {
                    hideOldContainer();
                    setTimeout(function() {
                        hideOldContainer();
                        // å¦‚æœä¹¦æ¶æ•°æ®å·²åŠ è½½ï¼Œè§¦å‘æ¸²æŸ“
                        if (window.App && window.App.bookshelfData) {
                            if (window.SmartBookshelf && window.SmartBookshelf.render) {
                                window.SmartBookshelf.render();
                            }
                        }
                    }, 200);
                });
                
                // å®šæœŸæ£€æŸ¥å¹¶éšè—ï¼ˆé˜²æ­¢è¢«å…¶ä»–è„šæœ¬æ˜¾ç¤ºï¼‰
                setInterval(hideOldContainer, 500);
            })();
        </script>

        <!-- PWA Service Worker æ³¨å†Œ -->
        <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/service-worker.js")
                        .then((registration) => {
                            console.log("SW registered:", registration.scope);
                        })
                        .catch((err) => {
                            console.log("SW registration failed:", err);
                        });
                });
            }
            
            // ä¿®å¤é¡µé¢åˆå§‹åŒ–æ»‘åŠ¨é—®é¢˜
            document.addEventListener('DOMContentLoaded', () => {
                // ç¡®ä¿ body å’Œæ ¹å…ƒç´ æ ·å¼æ­£ç¡®
                document.body.style.overflow = 'auto';
                document.documentElement.style.overflow = 'auto';
                
                // è§¦å‘ä¸€æ¬¡é‡æ’ä»¥ä¿®å¤æ½œåœ¨çš„æ¸²æŸ“é—®é¢˜
                setTimeout(() => {
                    document.body.style.display = 'none';
                    document.body.offsetHeight; // è§¦å‘é‡æ’
                    document.body.style.display = '';
                }, 100);
            });
        </script>
    </body>
</html>